<div class="drawer lg:drawer-open font-sans">
  <input id="app-drawer" type="checkbox" class="drawer-toggle" />
  
  <!-- Page Content -->
  <div class="drawer-content flex flex-col bg-base-100 text-base-content">
    
    <header class="bg-base-300 shadow-lg p-4 sticky top-0 z-30">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center">
           <label for="app-drawer" class="btn btn-square btn-ghost drawer-button lg:hidden mr-2">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
          </label>
          <h1 class="text-2xl font-bold tracking-wider hidden sm:block">PredX</h1>
        </div>
        
        <div class="flex items-center space-x-4">
          <button class="btn btn-ghost" (click)="setView('contact')">Contact Us</button>
          <div class="dropdown dropdown-end">
              <label tabindex="0" class="btn btn-ghost btn-circle">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
              </label>
               <select class="select select-bordered select-sm dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-32" (change)="changeTheme($event)">
                  @for(theme of themes; track theme) {
                    <option [value]="theme" class="capitalize">{{ theme }}</option>
                  }
              </select>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto p-4 md:p-6 flex-grow">
      <!-- Correlation Analysis View -->
      @if (activeView() === 'correlation') {
        <div class="bg-base-200 rounded-lg shadow-md p-4 mb-6">
          <label for="country-select" class="block text-sm font-medium mb-2">Select a Country:</label>
          <select id="country-select" [ngModel]="selectedCountry()" (change)="onCountryChange($event)"
                  class="select select-bordered w-full md:w-1/3">
            @for(country of countries; track country) {
              <option [value]="country">{{ country }}</option>
            }
          </select>
        </div>

        @if (isLoadingData()) {
          <div class="flex justify-center items-center h-96">
            <span class="loading loading-dots loading-lg text-primary"></span>
            <p class="ml-4 text-lg">Loading Data...</p>
          </div>
        } @else {
          <div>
            <!-- Charts Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <!-- Daily Cases Chart -->
              <div class="bg-base-200 p-4 rounded-lg shadow-xl h-80 flex flex-col">
                <div class="flex-grow">
                  <canvas #covidCasesChartCanvas></canvas>
                </div>
              </div>
              <!-- Daily Deaths Chart -->
              <div class="bg-base-200 p-4 rounded-lg shadow-xl h-80 flex flex-col">
                <div class="flex-grow">
                  <canvas #covidDeathsChartCanvas></canvas>
                </div>
              </div>
              <!-- Stock Market Chart -->
              <div class="bg-base-200 p-4 rounded-lg shadow-xl h-80 flex flex-col">
                <div class="flex-grow">
                  <canvas #stockChartCanvas></canvas>
                </div>
              </div>
              <!-- Mortality Rate Chart -->
              <div class="bg-base-200 p-4 rounded-lg shadow-xl h-80 flex flex-col">
                <div class="flex-grow">
                  <canvas #mortalityRateChartCanvas></canvas>
                </div>
              </div>
            </div>

            <!-- AI Analysis & Prediction Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- COVID Correlation Analysis -->
                <div class="bg-base-200 p-6 rounded-lg shadow-xl flex flex-col">
                  <h2 class="text-xl font-bold mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.363-.448-1.35-4.242a2 2 0 00-3.644 0l-1.35 4.242-2.363.448a2 2 0 00-1.023.547l-1.635 2.581a2 2 0 00.145 2.571l3.598 3.598a2 2 0 002.828 0l4.243-4.242a2 2 0 000-2.828l-1.635-2.581z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21a9 9 0 100-18 9 9 0 000 18z" /></svg>
                    COVID & Market Correlation
                  </h2>
                  <div class="flex-grow">
                    @if (isAnalyzing()) {
                      <div class="flex flex-col gap-4 w-full">
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-5/6"></div>
                      </div>
                    } @else {
                      <p class="leading-relaxed">{{ analysis() }}</p>
                    }
                  </div>
                </div>

                <!-- Stock Price Prediction -->
                 <div class="bg-base-200 p-6 rounded-lg shadow-xl flex flex-col">
                  <h2 class="text-xl font-bold mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                    Stock Index Prediction
                  </h2>
                  <div class="flex-grow">
                     @if (isPredicting()) {
                      <div class="flex flex-col gap-4 w-full">
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-full"></div>
                        <div class="skeleton h-4 w-5/6"></div>
                      </div>
                    } @else {
                      <p class="leading-relaxed">{{ stockPrediction() }}</p>
                    }
                  </div>
                </div>
            </div>
          </div>
        }
      }

      <!-- Stock Predictor View -->
      @if (activeView() === 'predictor') {
        <div class="bg-base-200 rounded-lg shadow-md p-4 mb-6">
          <label for="stock-select" class="block text-sm font-medium mb-2">Select a Stock:</label>
          <select id="stock-select" [ngModel]="selectedStock()" (change)="onStockChange($event)"
                  class="select select-bordered w-full md:w-1/3">
            @for(stock of stocks; track stock.ticker) {
              <option [value]="stock.ticker">{{ stock.name }} ({{ stock.ticker }})</option>
            }
          </select>
        </div>

        @if (isLoadingSingleStock()) {
          <div class="flex justify-center items-center h-96">
            <span class="loading loading-dots loading-lg text-primary"></span>
            <p class="ml-4 text-lg">Loading Stock Data...</p>
          </div>
        } @else {
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Chart -->
            <div class="lg:col-span-2 bg-base-200 p-4 rounded-lg shadow-xl h-[30rem] flex flex-col">
              <div class="flex-grow">
                <canvas #singleStockChartCanvas></canvas>
              </div>
              <p class="text-xs text-base-content/60 text-center mt-2 flex-shrink-0">Scroll to zoom, drag to pan.</p>
            </div>

            <!-- AI Prediction -->
            <div class="lg:col-span-1 bg-base-200 p-6 rounded-lg shadow-xl flex flex-col">
              <div class="mb-6">
                  <p class="text-sm font-medium mb-2">Prediction Period:</p>
                  <div class="join w-full">
                      <button class="join-item btn btn-sm flex-1" [class.btn-primary]="predictionPeriod() === 30" (click)="setPredictionPeriod(30)">30 Days</button>
                      <button class="join-item btn btn-sm flex-1" [class.btn-primary]="predictionPeriod() === 90" (click)="setPredictionPeriod(90)">90 Days</button>
                      <button class="join-item btn btn-sm flex-1" [class.btn-primary]="predictionPeriod() === 180" (click)="setPredictionPeriod(180)">180 Days</button>
                  </div>
              </div>

              <h2 class="text-xl font-bold mb-4 flex items-center">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                AI Price Forecast (Next {{ predictionPeriod() }} Days)
              </h2>
              <div class="flex-grow">
                 @if (isPredictingSingleStock()) {
                  <div class="flex flex-col gap-4 w-full">
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-5/6"></div>
                  </div>
                } @else {
                  <p class="leading-relaxed">{{ singleStockPrediction() }}</p>
                }
              </div>
            </div>
          </div>
        }
      }

      <!-- COVID Predictor View -->
      @if (activeView() === 'covidPredictor') {
        <div>
           <h2 class="text-3xl font-bold mb-2 text-center">COVID-19 Infection Predictor</h2>
           <p class="text-center mb-8 text-base-content/80">
            Fill in the details below to get an AI-powered assessment of COVID-19 infection likelihood. This is not a medical diagnosis.
           </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Input Form -->
            <form class="bg-base-200 p-6 rounded-lg shadow-xl space-y-4" (ngSubmit)="predictCovid()">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="form-control">
                  <label class="label"><span class="label-text">RT-PCR test result</span></label>
                  <select class="select select-bordered" [(ngModel)]="covidPcrResult" name="pcrResult">
                    <option>Not Tested</option>
                    <option>Positive</option>
                    <option>Negative</option>
                    <option>Awaiting Result</option>
                  </select>
                </div>
                 <div class="form-control">
                  <label class="label"><span class="label-text">Antigen test result</span></label>
                  <select class="select select-bordered" [(ngModel)]="covidAntigenResult" name="antigenResult">
                    <option>Not Tested</option>
                    <option>Positive</option>
                    <option>Negative</option>
                    <option>Awaiting Result</option>
                  </select>
                </div>
              </div>

              <div class="form-control">
                <label class="label"><span class="label-text">CT scan / X-ray data</span></label>
                <textarea class="textarea textarea-bordered" placeholder="e.g., Ground-glass opacities observed" [(ngModel)]="covidCtScanNotes" name="ctScanNotes"></textarea>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div class="form-control">
                  <label class="label"><span class="label-text">Body temperature (°C)</span></label>
                  <input type="number" step="0.1" placeholder="37.5" class="input input-bordered" [(ngModel)]="covidBodyTemperature" name="bodyTemp" />
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Respiratory rate</span></label>
                  <input type="number" placeholder="18" class="input input-bordered" [(ngModel)]="covidRespiratoryRate" name="respRate" />
                </div>
                <div class="form-control">
                  <label class="label"><span class="label-text">Age</span></label>
                  <input type="number" placeholder="35" class="input input-bordered" [(ngModel)]="covidAge" name="age" />
                </div>
              </div>

              <div class="form-control">
                <label class="label"><span class="label-text">Symptoms</span></label>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-2 bg-base-300 p-3 rounded-md">
                  @for(symptom of symptomOptions; track symptom) {
                    <label class="label cursor-pointer justify-start gap-2">
                      <input type="checkbox" class="checkbox checkbox-primary" (change)="updateSymptom(symptom, $event)" />
                      <span class="label-text">{{ symptomLabels[symptom] }}</span>
                    </label>
                  }
                </div>
              </div>

               <div class="form-control">
                <label class="label"><span class="label-text">Other Symptoms</span></label>
                <input type="text" placeholder="e.g., Headaches, muscle pain" class="input input-bordered" [(ngModel)]="covidOtherSymptoms" name="otherSymptoms" />
              </div>

              <button class="btn btn-primary w-full mt-4" type="submit" [disabled]="isPredictingCovid()">
                 @if (isPredictingCovid()) {
                  <span class="loading loading-spinner"></span>
                  Analyzing...
                 } @else {
                  Predict
                 }
              </button>
            </form>

            <!-- Prediction Result -->
            <div class="bg-base-200 p-6 rounded-lg shadow-xl flex flex-col">
              <h3 class="text-xl font-semibold mb-4">AI Prediction Analysis</h3>
              <div class="flex-grow">
                @if(isPredictingCovid()) {
                  <div class="flex flex-col gap-4 w-full">
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-full"></div>
                    <div class="skeleton h-4 w-5/6"></div>
                  </div>
                } @else if (covidPrediction()) {
                  <p class="whitespace-pre-wrap leading-relaxed">{{ covidPrediction() }}</p>
                } @else {
                  <div class="text-center text-base-content/60 flex flex-col items-center justify-center h-full">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                    <p>Your AI-powered analysis will appear here after you submit the form.</p>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Chatbot View -->
      @if (activeView() === 'chatbot') {
        <div class="flex flex-col h-[calc(100vh-10rem)] bg-base-200 rounded-lg shadow-xl">
          <!-- Chat History -->
          <div class="flex-grow p-4 overflow-y-auto">
            <div class="space-y-4">
              @for(message of chatHistory(); track $index) {
                @if (message.role === 'user') {
                  <div class="chat chat-end">
                    <div class="chat-bubble chat-bubble-primary">{{ message.text }}</div>
                  </div>
                } @else {
                  <div class="chat chat-start">
                    <div class="chat-bubble chat-bubble-secondary">{{ message.text }}</div>
                  </div>
                }
              }
              @if (isChatting()) {
                <div class="chat chat-start">
                  <div class="chat-bubble chat-bubble-secondary">
                    <span class="loading loading-dots loading-sm"></span>
                  </div>
                </div>
              }
            </div>
          </div>
          <!-- Chat Input -->
          <div class="p-4 bg-base-300 border-t border-base-100">
            <form (ngSubmit)="sendMessage()">
              <div class="join w-full">
                <input class="input input-bordered join-item w-full" 
                       placeholder="Type your message..." 
                       [(ngModel)]="chatMessage" 
                       name="chatMessage"
                       [disabled]="isChatting()"
                       (keyup.enter)="sendMessage()" />
                <button class="btn btn-primary join-item" type="submit" [disabled]="isChatting()">Send</button>
              </div>
            </form>
          </div>
        </div>
      }

      <!-- Contact Us View -->
      @if (activeView() === 'contact') {
        <div class="max-w-4xl mx-auto">
          <h2 class="text-3xl font-bold mb-6 text-center">Get in Touch</h2>
          <p class="text-center mb-10 text-lg text-base-content/80">
            We'd love to hear from you! Whether you have a question about features, trials, or anything else, our team is ready to answer all your questions.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- Contact Info -->
            <div class="bg-base-200 p-6 rounded-lg shadow-lg">
              <h3 class="text-xl font-semibold mb-4">Contact Information</h3>
              <div class="space-y-4">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
                  <span>contact@predx.com</span>
                </div>
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                  <span>+1 (555) 123-4567</span>
                </div>
                <div class="flex items-center">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                  <span>123 AI Avenue, Tech City, 90210</span>
                </div>
              </div>
            </div>

            <!-- Contact Form -->
            <div class="bg-base-200 p-6 rounded-lg shadow-lg">
               <h3 class="text-xl font-semibold mb-4">Send us a Message</h3>
               <form class="space-y-4">
                  <div>
                    <label class="label">
                      <span class="label-text">Your Name</span>
                    </label>
                    <input type="text" placeholder="John Doe" class="input input-bordered w-full" disabled />
                  </div>
                   <div>
                    <label class="label">
                      <span class="label-text">Your Email</span>
                    </label>
                    <input type="email" placeholder="john.doe@example.com" class="input input-bordered w-full" disabled />
                  </div>
                   <div>
                    <label class="label">
                      <span class="label-text">Message</span>
                    </label>
                    <textarea class="textarea textarea-bordered w-full" rows="4" placeholder="Your message..." disabled></textarea>
                  </div>
                  <button class="btn btn-primary w-full" type="submit" disabled>Submit</button>
               </form>
            </div>
          </div>
        </div>
      }
    </main>
  </div> 

  <!-- Sidebar -->
  <div class="drawer-side">
    <label for="app-drawer" aria-label="close sidebar" class="drawer-overlay"></label> 
    <div class="p-4 w-64 min-h-full bg-base-200 text-base-content flex flex-col">
      <h2 class="text-2xl font-bold mb-6 text-center">PredX</h2>
      <ul class="menu text-lg">
        <li [class.bordered]="activeView() === 'correlation'"><a (click)="setView('correlation')">Correlation Analysis</a></li>
        <li [class.bordered]="activeView() === 'predictor'"><a (click)="setView('predictor')">Stock Predictor</a></li>
        <li [class.bordered]="activeView() === 'covidPredictor'"><a (click)="setView('covidPredictor')">COVID-19 Predictor</a></li>
        <li [class.bordered]="activeView() === 'chatbot'"><a (click)="setView('chatbot')">AI Chatbot</a></li>
      </ul>
      <div class="mt-auto text-center text-xs">
          <p>&copy; 2024 PredX</p>
          <p>Final Year Project</p>
      </div>
    </div>
  </div>

  <!-- Floating Help Button -->
  <button class="btn btn-primary btn-circle fixed bottom-6 right-6 shadow-lg z-40" (click)="openHelpModal()">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
  </button>

  <!-- Help Modal -->
  <dialog #helpModal class="modal">
    <div class="modal-box">
      <form method="dialog">
        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">✕</button>
      </form>
      <h3 class="font-bold text-lg mb-4">PredX Help Assistant</h3>
      <p class="mb-4 text-sm">Have a question about how to use the app? Ask me below!</p>
      <form (ngSubmit)="submitHelpQuery()">
        <textarea class="textarea textarea-bordered w-full" 
                  rows="3" 
                  placeholder="e.g., How do I compare stocks?"
                  [(ngModel)]="helpQuery"
                  name="helpQuery"></textarea>
        <button class="btn btn-primary mt-2 w-full" type="submit" [disabled]="isGettingHelp()">
          @if (isGettingHelp()) {
            <span class="loading loading-spinner"></span>
          }
          Get Help
        </button>
      </form>

      @if (helpResponse()) {
        <div class="divider"></div>
        <p class="leading-relaxed">{{ helpResponse() }}</p>
      }
    </div>
    <form method="dialog" class="modal-backdrop">
      <button>close</button>
    </form>
  </dialog>
</div>